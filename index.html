import pygame
import random

# Инициализация
pygame.init()

# Настройки экрана
SCREEN_WIDTH = 800
SCREEN_HEIGHT = 400
screen = pygame.display.set_mode((SCREEN_WIDTH, SCREEN_HEIGHT))
pygame.display.set_caption("My Dash Clone")

# Цвета
WHITE = (255, 255, 255)
BLACK = (0, 0, 0)
BLUE = (0, 150, 255)
RED = (255, 50, 50)
GRAY = (100, 100, 100)

# Параметры игрока
player_size = 40
player_x = 100
player_y = SCREEN_HEIGHT - player_size - 50
player_vel_y = 0
gravity = 0.8
jump_strength = -15
is_jumping = False

# Параметры игры
game_speed = 5
max_speed = 15
level = 1
score = 0
state = "MENU" # Возможные состояния: MENU, PLAYING, GAMEOVER

# Препятствия
obstacles = []

def draw_player(x, y):
    pygame.draw.rect(screen, BLUE, (x, y, player_size, player_size))

def draw_obstacle(obs):
    # Рисуем треугольник
    points = [
        (obs.x, obs.y + player_size), 
        (obs.x + player_size // 2, obs.y), 
        (obs.x + player_size, obs.y + player_size)
    ]
    pygame.draw.polygon(screen, RED, points)

def show_text(text, x, y, size=36, color=BLACK):
    font = pygame.font.SysFont("Arial", size)
    render = font.render(text, True, color)
    screen.blit(render, (x, y))

# Главный цикл
running = True
clock = pygame.time.Clock()

while running:
    screen.fill(WHITE)
    
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False
        
        if event.type == pygame.MOUSEBUTTONDOWN:
            mx, my = pygame.mouse.get_pos()
            
            if state == "MENU":
                if 300 < mx < 500 and 150 < my < 200: # Кнопка Play
                    state = "PLAYING"
                    obstacles = []
                    game_speed = 5
                elif 300 < mx < 500 and 220 < my < 270: # Shop (заглушка)
                    print("Магазин пока пуст!")
            
            elif state == "PLAYING":
                if not is_jumping:
                    player_vel_y = jump_strength
                    is_jumping = True
            
            elif state == "GAMEOVER":
                if 300 < mx < 500 and 250 < my < 300: # Restart
                    state = "PLAYING"
                    obstacles = []
                    player_y = SCREEN_HEIGHT - player_size - 50
                    game_speed = 5
                    score = 0

    if state == "MENU":
        show_text("GEOMETRY CLONE", 280, 50, 48)
        pygame.draw.rect(screen, BLUE, (300, 150, 200, 50))
        show_text("PLAY", 365, 160, color=WHITE)
        
        pygame.draw.rect(screen, GRAY, (300, 220, 200, 50))
        show_text("SHOP", 365, 230, color=WHITE)
        
        show_text("ONLINE (Скоро)", 320, 300, 24, color=GRAY)

    elif state == "PLAYING":
        # Гравитация и прыжок
        player_vel_y += gravity
        player_y += player_vel_y
        
        if player_y >= SCREEN_HEIGHT - player_size - 50:
            player_y = SCREEN_HEIGHT - player_size - 50
            is_jumping = False
            
        draw_player(player_x, player_y)
        pygame.draw.line(screen, BLACK, (0, SCREEN_HEIGHT-50), (SCREEN_WIDTH, SCREEN_HEIGHT-50), 2)

        # Создание препятствий
        if len(obstacles) == 0 or obstacles[-1].x < SCREEN_WIDTH - 300:
            if random.randint(0, 100) < 2:
                obstacles.append(pygame.Rect(SCREEN_WIDTH, SCREEN_HEIGHT - 90, player_size, player_size))

        # Движение и отрисовка препятствий
        for obs in obstacles[:]:
            obs.x -= game_speed
            draw_obstacle(obs)
            
            # Коллизия (проигрыш)
            if pygame.Rect(player_x, player_y, player_size, player_size).colliderect(obs):
                state = "GAMEOVER"
            
            if obs.x < -player_size:
                obstacles.remove(obs)
                score += 1
                # Увеличение скорости с ограничением
                if game_speed < max_speed:
                    game_speed += 0.1

        show_text(f"Score: {score}", 10, 10)

    elif state == "GAMEOVER":
        show_text("ВЫ ПРОИГРАЛИ!", 280, 150, 48, RED)
        pygame.draw.rect(screen, BLUE, (300, 250, 200, 50))
        show_text("RESTART", 345, 260, color=WHITE)

    pygame.display.flip()
    clock.tick(60)

pygame.quit()
