<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stanbot Blox 3D</title>
<style>
  body { margin:0; padding:0; overflow:hidden; font-family: Arial,sans-serif; }
  #game { width:100vw; height:100vh; display:block; }
  #instructions {
    position:absolute;
    top:10px;
    left:10px;
    color:white;
    background: rgba(0,0,0,0.5);
    padding:10px;
    border-radius:5px;
    z-index:10;
  }
</style>
</head>
<body>
<div id="instructions">
  WASD — движение<br>
  Мышь/сенсор — поворот камеры
</div>
<div id="game"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/PointerLockControls.js"></script>

<script>
let scene, camera, renderer, controls;
let player;
let moveForward=false, moveBackward=false, moveLeft=false, moveRight=false;
let velocity = new THREE.Vector3();
let clock = new THREE.Clock();

init();
animate();

function init(){
  // Сцена и камера
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x87ceeb); // дневное небо
  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

  // Рендер
  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.shadowMap.enabled = true;
  document.getElementById('game').appendChild(renderer.domElement);

  // Свет
  const light = new THREE.DirectionalLight(0xffffff,1);
  light.position.set(50,100,50);
  light.castShadow = true;
  scene.add(light);
  scene.add(new THREE.AmbientLight(0xffffff,0.3));

  // Пол
  const floorGeometry = new THREE.PlaneGeometry(500,500);
  const floorMaterial = new THREE.MeshStandardMaterial({color:0x228B22});
  const floor = new THREE.Mesh(floorGeometry, floorMaterial);
  floor.rotation.x = -Math.PI/2;
  floor.receiveShadow = true;
  scene.add(floor);

  // Игрок (куб)
  const playerGeometry = new THREE.BoxGeometry(2,4,2);
  const playerMaterial = new THREE.MeshStandardMaterial({color:0xff0000});
  player = new THREE.Mesh(playerGeometry,playerMaterial);
  player.position.set(0,2,0);
  player.castShadow = true;
  scene.add(player);

  // Камера + управление мышью
  controls = new THREE.PointerLockControls(camera, document.body);
  camera.position.y = 2; // глаза персонажа
  scene.add(controls.getObject());

  document.addEventListener('click',()=>{controls.lock();},false);

  // События клавиш
  const onKeyDown = function(e){
    switch(e.code){
      case 'KeyW': moveForward = true; break;
      case 'KeyS': moveBackward = true; break;
      case 'KeyA': moveLeft = true; break;
      case 'KeyD': moveRight = true; break;
    }
  }
  const onKeyUp = function(e){
    switch(e.code){
      case 'KeyW': moveForward = false; break;
      case 'KeyS': moveBackward = false; break;
      case 'KeyA': moveLeft = false; break;
      case 'KeyD': moveRight = false; break;
    }
  }
  document.addEventListener('keydown', onKeyDown, false);
  document.addEventListener('keyup', onKeyUp, false);

  window.addEventListener('resize', ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
}

function animate(){
  requestAnimationFrame(animate);

  const delta = clock.getDelta();
  const speed = 10;

  velocity.x -= velocity.x * 10.0 * delta;
  velocity.z -= velocity.z * 10.0 * delta;

  if(moveForward) velocity.z -= speed * delta;
  if(moveBackward) velocity.z += speed * delta;
  if(moveLeft) velocity.x -= speed * delta;
  if(moveRight) velocity.x += speed * delta;

  controls.moveRight(-velocity.x);
  controls.moveForward(-velocity.z);

  // Камера следует за игроком
  const playerPos = controls.getObject().position;
  player.position.set(playerPos.x,2,playerPos.z);

  renderer.render(scene, camera);
}
</script>
</body>
</html>
